allClasses = [
  [
    {
      "CS260": [
        {
          "subject": "CS",
          "number": "260",
          "instrType": "Lecture",
          "instrMethod": "Face to Face",
          "section": "001",
          "crn": "20096",
          "descr": "Data Structures",
          "instructor": "Kurt Schmidt",
          "time": [
            {
              "M": "3:00pm - 3:50pm"
            },
            {
              "W": "3:00pm - 3:50pm"
            },
            {
              "F": "3:00pm - 3:50pm"
            }
          ]
        },
        {
          "subject": "CS",
          "number": "260",
          "instrType": "Lecture",
          "instrMethod": "Face to Face",
          "section": "002",
          "crn": "21663",
          "descr": "Data Structures",
          "instructor": "Kurt Schmidt",
          "time": [
            {
              "M": "2:00pm - 2:50pm"
            },
            {
              "W": "2:00pm - 2:50pm"
            },
            {
              "F": "2:00pm - 2:50pm"
            }
          ]
        },
        {
          "subject": "CS",
          "number": "260",
          "instrType": "Lecture",
          "instrMethod": "Face to Face",
          "section": "003",
          "crn": "20378",
          "descr": "Data Structures",
          "instructor": "Kurt Schmidt",
          "time": [
            {
              "W": "6:00pm - 8:50pm"
            }
          ]
        },
        {
          "subject": "CS",
          "number": "260",
          "instrType": "Lecture",
          "instrMethod": "Face to Face",
          "section": "004",
          "crn": "22453",
          "descr": "Data Structures",
          "instructor": "Kurt Schmidt",
          "time": [
            {
              "M": "10:00am - 10:50am"
            },
            {
              "W": "10:00am - 10:50am"
            },
            {
              "F": "10:00am - 10:50am"
            }
          ]
        },
        {
          "subject": "CS",
          "number": "260",
          "instrType": "Lecture",
          "instrMethod": "Face to Face",
          "section": "005",
          "crn": "22449",
          "descr": "Data Structures",
          "instructor": "Krzysztof Nowak",
          "time": [
            {
              "T": "6:30pm - 9:20pm"
            }
          ]
        }
      ]
    }
  ],
  [
    {
      "CS283": [
        {
          "subject": "CS",
          "number": "283",
          "instrType": "Lecture",
          "instrMethod": "Face to Face",
          "section": "001",
          "crn": "21356",
          "descr": "Systems Programming",
          "instructor": "Constantine Katsinis",
          "time": [
            {
              "M": "6:00pm - 8:50pm"
            }
          ]
        },
        {
          "subject": "CS",
          "number": "283",
          "instrType": "Lecture",
          "instrMethod": "Face to Face",
          "section": "002",
          "crn": "21719",
          "descr": "Systems Programming",
          "instructor": "Constantine Katsinis",
          "time": [
            {
              "R": "6:30pm - 9:20pm"
            }
          ]
        },
        {
          "subject": "CS",
          "number": "283",
          "instrType": "Lecture",
          "instrMethod": "Face to Face",
          "section": "003",
          "crn": "22154",
          "descr": "Systems Programming",
          "instructor": "Constantine Katsinis",
          "time": [
            {
              "T": "6:30pm - 9:20pm"
            }
          ]
        },
        {
          "subject": "CS",
          "number": "283",
          "instrType": "Lecture",
          "instrMethod": "Face to Face",
          "section": "004",
          "crn": "22454",
          "descr": "Systems Programming",
          "instructor": "Constantine Katsinis",
          "time": [
            {
              "T": "3:30pm - 4:50pm"
            },
            {
              "R": "3:30pm - 4:50pm"
            }
          ]
        }
      ]
    }
  ],
  [
    {
      "MATH221": [
        {
          "subject": "MATH",
          "number": "221",
          "instrType": "Lecture",
          "instrMethod": "Face to Face",
          "section": "001",
          "crn": "20095",
          "descr": "Discrete Mathematics",
          "instructor": "Marci A Perlstadt",
          "time": [
            {
              "M": "9:00am - 9:50am"
            },
            {
              "W": "9:00am - 9:50am"
            },
            {
              "F": "9:00am - 9:50am"
            }
          ]
        },
        {
          "subject": "MATH",
          "number": "221",
          "instrType": "Lecture",
          "instrMethod": "Face to Face",
          "section": "002",
          "crn": "21388",
          "descr": "Discrete Mathematics",
          "instructor": "Eric J Schmutz",
          "time": [
            {
              "M": "1:00pm - 1:50pm"
            },
            {
              "W": "1:00pm - 1:50pm"
            },
            {
              "F": "1:00pm - 1:50pm"
            }
          ]
        },
        {
          "subject": "MATH",
          "number": "221",
          "instrType": "Lecture",
          "instrMethod": "Face to Face",
          "section": "003",
          "crn": "20095",
          "descr": "Discrete Mathematics",
          "instructor": "Staff",
          "time": [
            {
              "M": "12:00pm - 12:50pm"
            },
            {
              "W": "12:00pm - 12:50pm"
            },
            {
              "F": "12:00pm - 12:50pm"
            }
          ]
        },
        {
          "subject": "MATH",
          "number": "221",
          "instrType": "Lecture",
          "instrMethod": "Face to Face",
          "section": "004",
          "crn": "20468",
          "descr": "Data Structures",
          "instructor": "Marci A Perlstadt",
          "time": [
            {
              "M": "10:00am - 10:50am"
            },
            {
              "W": "10:00am - 10:50am"
            },
            {
              "F": "10:00am - 10:50am"
            }
          ]
        },
        {
          "subject": "MATH",
          "number": "221",
          "instrType": "Lecture",
          "instrMethod": "Face to Face",
          "section": "005",
          "crn": "21987",
          "descr": "Discrete Mathematics",
          "instructor": "Georgi Medvedev",
          "time": [
            {
              "T": "9:30am - 10:50am"
            },
            {
              "R": "9:30am - 10:50am"
            }
          ]
        }
      ]
    }
  ],
  [
    {
      "MATHT480": [
        {
          "subject": "MATH",
          "number": "T480",
          "instrType": "Lecture",
          "instrMethod": "Face to Face",
          "section": "001",
          "crn": "25862",
          "descr": "Theory of Computation",
          "instructor": "Robert A Hicks",
          "time": [
            {
              "M": "1:00pm - 1:50pm"
            },
            {
              "W": "1:00pm - 1:50pm"
            },
            {
              "F": "1:00pm - 1:50pm"
            }
          ]
        }
      ]
    }
  ],
  [
    {
      "BIO349": [
        {
          "subject": "BIO",
          "number": "349",
          "instrType": "Lecture",
          "instrMethod": "Face to Face",
          "section": "001",
          "crn": "23098",
          "descr": "Behavioral Neuroscience",
          "instructor": "Michael R Akins, Anna Denise R Garcia",
          "time": [
            {
              "T": "12:30pm - 1:50pm"
            },
            {
              "R": "12:30pm - 1:50pm"
            }
          ]
        }
      ]
    }
  ],
  [
    {
      "PHIL311": [
        {
          "subject": "PHIL",
          "number": "311",
          "instrType": "Lecture",
          "instrMethod": "Face to Face",
          "section": "130",
          "crn": "21728",
          "descr": "Ethics and Information Technology",
          "instructor": "Roger J Magyar",
          "time": [
            {
              "W": "3:30pm - 4:50pm"
            }
          ]
        },
        {
          "subject": "PHIL",
          "number": "311",
          "instrType": "Lecture",
          "instrMethod": "Face to Face",
          "section": "131",
          "crn": "23110",
          "descr": "Ethics and Information Technology",
          "instructor": "Roger J Magyar",
          "time": [
            {
              "W": "12:30pm - 1:50pm"
            }
          ]
        }
      ]
    }
  ]
]

function overlap(times1, times2) {
	var res = false;
	for (var i=0; i<times1.length; i++) {
		for (var j=0; j<times2.length; j++) {
			res = res || overlapTimes(convert(times1[i]), convert(times2[j]));
		}
	}
	return res;
}

function overlapTimes(time1, time2) {
	return (Math.max(time1.startTime, time2.startTime) <= Math.min(time1.endTime, time2.endTime));
}

function convert(timeInput) {
	for (var day in timeInput) {
		var time = timeInput[day];
		var timeList = time.split(" - ");
		var boundaries = {
			"startTime" : dayConvert(day, timeList[0]),
			"endTime" : dayConvert(day, timeList[1])
		};
		return boundaries;
	}
}

function dayConvert(day, time) {
	if (day == "M") return parseInt(convertTime(time)) + 0 * 24 * 60;
	if (day == "T") return parseInt(convertTime(time)) + 1 * 24 * 60;
	if (day == "W") return parseInt(convertTime(time)) + 2 * 24 * 60
	if (day == "R") return parseInt(convertTime(time)) + 3 * 24 * 60
	if (day == "F") return parseInt(convertTime(time)) + 4 * 24 * 60
	if (day == "S") return parseInt(convertTime(time)) + 5 * 24 * 60
}


function convertTime(time) {
	var hours = Number(time.match(/^(\d+)/)[1]);
    var minutes = Number(time.match(/:(\d+)/)[1]);
    var AMPM = time.match(/\s?([AaPp][Mm]?)$/)[1];
    var pm = ['P', 'p', 'PM', 'pM', 'pm', 'Pm'];
    var am = ['A', 'a', 'AM', 'aM', 'am', 'Am'];

	if (pm.indexOf(AMPM) >= 0 && hours < 12) hours = hours + 12;
	if (am.indexOf(AMPM) >= 0 && hours == 12) hours = hours - 12;

  /*
    var sHours = hours.toString();
    var sMinutes = minutes.toString();

	if (hours < 10) sHours = "0" + sHours;
	if (minutes < 10) sMinutes = "0" + sMinutes;
  */
    return (60 * hours + minutes);
}

function isValidSchedule(sectionToAdd, schedule){
  for (otherClass of schedule){
    if(overlap(otherClass.time, sectionToAdd.time)){
      return false
    }
  }
  return true
}

function findPossibleSchedules(classes, list, schedule) {
  if (classes.length == 0){
    list.push(schedule);
    return true
  }
  var className = Object.keys(classes[0][0])[0]
  var classToAdd = classes[0][0][className]
  for (section of classToAdd){
    if (isValidSchedule(section, schedule)){
      newSchedule = schedule.slice()
      newSchedule.push(section)
      if(findPossibleSchedules(classes.slice(1), list, newSchedule)){
      }
    }
  }
}

function findAllSchedules(classes, restrictions) {
  classes = allClasses
  filteredClasses = [];
  for(var c of classes){
    filteredKeys = [];
    for(var key of c){
      filteredKeywords = [];
      for(var keyword in key){
        filteredSections = [];
        for(var section of key[keyword]){
          overlaping = false;
          for(var time of section.time){
            boundaries = convert(time);
            for(var restriction of restrictions){
              if(overlapTimes(restriction, boundaries)){
                overlaping = true;
              }
            }
          }
          if(!overlaping){
            filteredSections.push(section);
          }
        }
        filteredKeywords.push({keyword: filteredSections})
      }
      filteredClasses.push(filteredKeywords);
    }
  }

  var list = []
  findPossibleSchedules(filteredClasses, list, [])
  console.log(list.length)
  console.log(JSON.stringify(list));
}
